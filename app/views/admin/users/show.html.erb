<div id="Infogram">
  <div class="infogram_inner">
    <div class="callout">
     <h2>Hola <%= @user.first_name+" "+@user.last_name %></h2>
     <h4><%= link_to "Ver Perfil", controller: "users", action: "profile", id: @user  %></h4>
    </div>

    <div class="data-board">
      <ul>
        <li>
          <%= @deliveries.length %>
          <span>Cantidad de envíos mes:</span>
        </li>
        <li>
          <%= @total_envios %>
          <span>Cantidad de envíos histórico:</span>
        </li>
        <li>
          <%= @total_comission %>
          <span>Total Comisión:</span> 
        </li>
      </ul>
    </div>
  </div>
</div>



<div class="infotable">

    <ul class="infotable-nav" id="imageGallery">
      <li><a class='' href="admin_deliveries_path()" data-beloworigin="true" href='#' data-activates='dropdown1'>Todos</a></li>
    <li><%= link_to "Nuevo Envio" %> </li>
      <li><%= link_to "REVISAR" %></li>
    <li><%= link_to "RESEÑAS" %></li>
    <li><%= link_to "FAQ", "#" %></li>
    </ul>

  <div class="infotable-inner">
    <div class="callout">
        <h4>Detalle de Envios</h4>
    </div>

    <div class="infotable-filters">
        <%= select("user_delivery", "month", month_options, {include_blank: "Todos los meses", selected: @month}, :onchange => 'filter();') %>
        <%= select("user_delivery", "year", anos_options, {include_blank: "Todos los años", selected: @year}, :onchange => 'filter();') %>
    </div>
  </div>

  <table>
   <thead>
     <tr>
       <th>Remitente</th>
       <th>Address inicio</th>
       <th>Address entrega</th>
       <th>Destinatario</th>
       <th>Kms</th>
       <th>Fecha</th>
       <th>Comision</th>
     </tr>
   </thead>

   <tbody>
   <% @deliveries.each do |delivery| %>
       <tr>
         <td><%= delivery.sender.business_name %></td>  
         <td><%= delivery.address_start %>, <%= delivery.comuna_start %></td>
         <td><%= delivery.address_finish %>, <%= delivery.comuna_finish %></td>
         <td><%= delivery.destinatary_name %></td>
         <td><%= delivery.km %></td>
         <td><%= delivery.created_at.strftime("%d/%m/%Y") %></td>
         <td>$<%= delivery.comission %></td>
       </tr>
   <% end %>
   </tbody>
  </table>
</div>

<script>
    var filter = function(){
        console.log($('#user_delivery_month').val());
        console.log($('#user_delivery_year').val());
        var query = updateQueryStringParameter(window.location.href, 'month', $('#user_delivery_month').val());
        query = updateQueryStringParameter(query, 'year', $('#user_delivery_year').val());
        window.open(query , "_self");
    }

    function updateQueryStringParameter(uri, key, value) {
        var re = new RegExp("([?&])" + key + "=.*?(&|$)", "i");
        var separator = uri.indexOf('?') !== -1 ? "&" : "?";
        if (uri.match(re)) {
            return uri.replace(re, '$1' + key + "=" + value + '$2');
        }
        else {
            return uri + separator + key + "=" + value;
        }
    }
</script>

<script>
    $(document).ready(function() {
        $('select').material_select();
    });
</script>




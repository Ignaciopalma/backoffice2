var directionsService=new google.maps.DirectionsService,directionsDisplay=new google.maps.DirectionsRenderer;directionsDisplay.suppressMarkers=!0;var handler="",handler=Gmaps.build("Google");handler.buildMap({provider:{disableDefaultUI:!0,center:new google.maps.LatLng(-33.4575978,-70.6428367)},internal:{id:"map"}});var input=document.getElementById("route-start"),input2=document.getElementById("route-end"),options={componentRestrictions:{country:"cl"}},searchBox=new google.maps.places.Autocomplete(input,options),searchBox2=new google.maps.places.Autocomplete(input2,options),originMarker,destinationMarker,routeOn=!1;google.maps.event.addListener(searchBox,"place_changed",function(){var e=searchBox.getPlace(),o=$("#finish-lat").val(),t=$("#finish-lng").val();if(destinationMarker&&o&&t||routeOn&&o&&t){console.log("making route with the new origin"),originMarker&&(originMarker.isAdded=!1),directionsDisplay.setMap(null),directionsDisplay.setMap(handler.getMap());var n="",n=new google.maps.LatLng(e.geometry.location.G,e.geometry.location.K),a=new google.maps.LatLng(o,t),i={origin:n,destination:a,travelMode:google.maps.DirectionsTravelMode.WALKING};directionsService.route(i,function(e,o){o==google.maps.DirectionsStatus.OK&&(console.log(e),$("#km ").val(parseInt(e.routes[0].legs[0].distance.text.split(" ")[0])),$("#eta ").val(parseInt(e.routes[0].legs[0].duration.text.split(" ")[0])/4),directionsDisplay.setDirections(e))}),$("#start-lat").val(e.geometry.location.G),$("#start-lng").val(e.geometry.location.K),$("#comuna-start").val(e.address_components[3].short_name),routeOn=!0}else console.log("creating origin"),console.log(e),originMarker=handler.addMarkers([{lat:e.geometry.location.G,lng:e.geometry.location.K}]),handler.bounds.extendWith(originMarker),handler.fitMapToBounds(),$("#start-lat").val(e.geometry.location.G),$("#start-lng").val(e.geometry.location.K),$("#comuna-start").val(e.address_components[3].short_name)}),google.maps.event.addListener(searchBox2,"place_changed",function(){var e=searchBox2.getPlace(),o=$("#start-lat").val(),t=$("#start-lng").val();if(originMarker&&o&&t||routeOn&&o&&t){console.log("making route with the new destination"),destinationMarker&&(destinationMarker.isAdded=!1),directionsDisplay.setMap(null),directionsDisplay.setMap(handler.getMap());var n="",n=new google.maps.LatLng(e.geometry.location.G,e.geometry.location.K),a=new google.maps.LatLng(o,t),i={origin:a,destination:n,travelMode:google.maps.DirectionsTravelMode.WALKING};directionsService.route(i,function(e,o){o==google.maps.DirectionsStatus.OK&&(console.log(e),$("#km ").val(parseInt(e.routes[0].legs[0].distance.text.split(" ")[0])),$("#eta ").val(parseInt(e.routes[0].legs[0].duration.text.split(" ")[0]/4)),directionsDisplay.setDirections(e))}),$("#finish-lat").val(e.geometry.location.G),$("#finish-lng").val(e.geometry.location.K),$("#comuna-finish").val(e.address_components[3].short_name),routeOn=!0}else console.log("creating destinations"),destinationMarker=handler.addMarkers([{lat:e.geometry.location.G,lng:e.geometry.location.K}]),handler.bounds.extendWith(destinationMarker),handler.fitMapToBounds(),$("#finish-lat").val(e.geometry.location.G),$("#finish-lng").val(e.geometry.location.K),$("#comuna-finish").val(e.address_components[3].short_name)}),$("form").on("keypress",function(e){return 13==e.keyCode?!1:void 0});